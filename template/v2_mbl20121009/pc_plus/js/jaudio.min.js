// - Author: Michael Mammoliti
// - Name: jAudio.js
// - Version: 0.2.0
// - js dipendencies: jQuery
// - Release: 25 November 2015

// License Info
// Released under the MIT license.
(function(c){function d(a,b){this.settings=c.extend(!0,e,b);this.$context=a;this.domAudio=this.$context.find("audio")[0];this.$domPlaylist=this.$context.find(".jAudio-playlist");this.$domControls=this.$context.find(".jAudio-controls");this.$domVolumeBar=this.$context.find(".jAudio--volume");this.$domDetails=this.$context.find(".jAudio-details");this.$domStatusBar=this.$context.find(".jAudio-status-bar");this.$domProgressBar=this.$context.find(".jAudio-progress-bar-wrapper");this.$domTime=this.$context.find(".jAudio-time");this.$domElapsedTime=this.$context.find(".jAudio-time-elapsed");this.$domTotalTime=this.$context.find(".jAudio-time-total");this.$domThumb=this.$context.find(".jAudio-thumb");this.currentState="pause";this.currentTrack=this.settings.defaultTrack;this.timer=this.currentElapsedTime=void 0;this.init()}var e={playlist:[],defaultAlbum:void 0,defaultArtist:void 0,defaultTrack:0,autoPlay:!1,debug:!1};d.prototype={init:function(){this.renderPlaylist();this.preLoadTrack();this.highlightTrack();this.updateTotalTime();this.events();this.debug();this.domAudio.volume=1},play:function(a){this.domAudio.play();"play"!==this.currentState&&(clearInterval(this.timer),this.timer=setInterval(this.run.bind(this),50),this.currentState="play",a.data("action","pause"),a.removeClass("jAudio-control-play"),a.addClass("jAudio-control-pause"),a.toggleClass("active"),c(".jAudio-thumb").removeClass("jAudio-thumb-paused"),c(".jAudio-thumb").addClass("jAudio-thumb-rotation jAudio-thumb-running"))},pause:function(a){this.domAudio.pause();clearInterval(this.timer);this.currentState="pause";a.data("action","play");a.removeClass("jAudio-control-pause");a.addClass("jAudio-control-play");a.toggleClass("active");c(".jAudio-thumb").removeClass("jAudio-thumb-running");c(".jAudio-thumb").addClass("jAudio-thumb-rotation jAudio-thumb-paused")},stop:function(a){this.domAudio.pause();this.domAudio.currentTime=0;this.animateProgressBarPosition();clearInterval(this.timer);this.updateElapsedTime();this.currentState="stop"},prev:function(a){var b;0===this.currentTrack?b=this.settings.playlist.length-1:b=this.currentTrack-1;this.changeTrack(b)},next:function(a){var b;this.currentTrack===this.settings.playlist.length-1?b=0:b=this.currentTrack+1;this.changeTrack(b)},preLoadTrack:function(){this.changeTrack(this.settings.defaultTrack);this.stop()},changeTrack:function(a){this.currentTrack=a;this.domAudio.src=this.settings.playlist[a].file;("play"===this.currentState||this.settings.autoPlay)&&this.play();this.highlightTrack();this.updateThumb();this.renderDetails()},events:function(){var a=this;a.$domControls.on("click",".jAudio-control",function(){var b=c(this);switch(b.data("action")){case "prev":a.prev.call(a,b);break;case "next":a.next.call(a,b);break;case "pause":a.pause.call(a,b);break;case "stop":a.stop.call(a,b);break;case "play":a.play.call(a,b)}});a.$domPlaylist.on("click",".jAudio-playlist-item",function(b){b=c(this);b.data("track");b=b.index();a.currentTrack!==b&&a.changeTrack(b)});a.$domProgressBar.on("click",function(b){a.updateProgressBar(b);a.updateElapsedTime()});c(a.domAudio).on("loadedmetadata",function(){a.animateProgressBarPosition.call(a);a.updateElapsedTime.call(a);a.updateTotalTime.call(a)})},getAudioSeconds:function(a){a=this.addZero(Math.floor(a%60),2);60>a||(a="00");return a},getAudioMinutes:function(a){a=this.addZero(Math.floor(a/60),2);60>a||(a="00");return a},addZero:function(a,b){for(a=String(a);a.length<b;)a="0"+a;return a},removeZero:function(a,b){a=String(a);for(var c=0;c<b;){if("0"===a[0])a=a.substr(1,a.length);else break;c++}return a},highlightTrack:function(){var a=this.$domPlaylist.children();a.removeClass("active");a.eq(this.currentTrack).addClass("active");"pause"===this.currentState&&c(".jAudio-thumb").removeClass("jAudio-thumb-rotation jAudio-thumb-running jAudio-thumb-paused")},renderDetails:function(){this.$domDetails.html(""+("\x3cspan\x3e"+this.settings.playlist[this.currentTrack].trackName+"\x3c/span\x3e"))},renderPlaylist:function(){var a="";c.each(this.settings.playlist,function(b,c){var d=c.thumb,e=c.trackName,g=c.trackArtist,h=c.trackAlbum,f=c.trackComment;a+="\x3cdiv class\x3d'jAudio-playlist-item' data-track\x3d'"+c.file+"'\x3e";a+="\x3cdiv class\x3d'jAudio-playlist-thumb'\x3e\x3ca href\x3d'"+f+"' class\x3d'jAudio-playlist-details'\x3e\x3cimg src\x3d'"+d+"'\x3e\x3c/a\x3e\x3c/div\x3e";a+="\x3cdiv class\x3d'jAudio-playlist-meta'\x3e";a+="\x3ch1 class\x3d'jAudio-playlist-name'\x3e"+e+"\x3c/h1\x3e";a+="\x3cp class\x3d'jAudio-playlist-artist'\x3e"+g+h+"\x3c/p\x3e";a+="\x3c/div\x3e";a+="\x3ca href\x3d'"+f+"' class\x3d'jAudio-playlist-comment'\x3e\x3ci class\x3d'vt-talk'\x3e\x3c/i\x3e\x3c/a\x3e";a+="\x3c/div\x3e"});this.$domPlaylist.html(a)},run:function(){this.animateProgressBarPosition();this.updateElapsedTime();this.domAudio.ended&&this.next()},animateProgressBarPosition:function(){var a={width:100*this.domAudio.currentTime/this.domAudio.duration+"%"};this.$domProgressBar.children().eq(0).css(a)},updateProgressBar:function(a){var b;a.offsetX&&(b=a.offsetX);void 0===b&&a.layerX&&(b=a.layerX);a=b/this.$domProgressBar.width();this.domAudio.currentTime=this.domAudio.duration*a;this.animateProgressBarPosition()},updateElapsedTime:function(){var a=this.domAudio.currentTime,b=this.getAudioMinutes(a),a=this.getAudioSeconds(a);this.$domElapsedTime.text(b+":"+a)},updateTotalTime:function(){var a=this.domAudio.duration,b=this.getAudioMinutes(a),a=this.getAudioSeconds(a);this.$domTotalTime.text(b+":"+a)},updateThumb:function(){this.$domThumb.css({"background-image":"url("+this.settings.playlist[this.currentTrack].thumb+")"})},debug:function(){this.settings.debug&&console.log(this.settings)}};c.fn.jAudio=function(a){c(this).each(function(){return new d(c(this),a)})}})(jQuery);